<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€6çš„è¥¿ç“œ - åˆæˆå¤§è¥¿ç“œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f0f8e8;
            --primary: #5a9f5a;
            --secondary: #ff6b6b;
            --accent: #f7dc6f;
            --text: #2c3e50;
            --card: #ffffff;
            --shadow: rgba(90,159,90,0.2);
            --dark-green: #27ae60;
            --light-green: #a8e6cf;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, var(--light-green) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 20px;
        }

        .game-title {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px var(--shadow);
            animation: pulse 2s infinite;
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .start-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 40px;
        }

        .game-canvas {
            position: relative;
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #gameCanvas {
            border-radius: 20px;
            touch-action: none;
        }

        .info-panel {
            background: var(--card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .info-item {
            margin-bottom: 20px;
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .info-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .achievement-item {
            background: var(--card);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .achievement-item:hover {
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .achievement-text {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .watermelon-levels {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .level-item {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }

        .level-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            opacity: 0.3;
        }

        .level-item.active .level-icon {
            opacity: 1;
            color: var(--secondary);
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .overlay-content {
            text-align: center;
            color: white;
        }

        .overlay-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .overlay-score {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--accent);
        }

        .retry-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            background: #e55;
            transform: translateY(-2px);
        }

        .game-message {
            position: absolute;
            background: var(--card);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 50;
            opacity: 0;
            animation: messageSlideIn 0.5s ease forwards;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .mobile-warning {
            background: var(--secondary);
            color: white;
            text-align: center;
            padding: 20px;
            font-weight: 600;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .game-title {
                font-size: 2.5rem;
            }

            .info-panel {
                grid-column: 1 / -1;
                position: static;
            }

            .achievement-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .watermelon-levels {
                justify-content: center;
            }
        }

        .canvas-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .level-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header class="header">
            <h1 class="game-title animate__animated animate__bounceInDown">è€6çš„è¥¿ç“œ</h1>
            <p class="game-subtitle">åˆæˆæ›´å¤§çš„è¥¿ç“œï¼ŒæŒ‘æˆ˜æ›´é«˜åˆ†ï¼</p>
            <button class="start-btn animate__animated animate__pulse animate__infinite" onclick="startGame()">
                <i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ
            </button>
        </header>

        <div class="game-layout">
            <div class="canvas-container">
                <div class="level-indicator" id="levelIndicator">å½“å‰ç­‰çº§: 1</div>
                <div class="game-canvas">
                    <canvas id="gameCanvas" width="600" height="600"></canvas>
                </div>
                <div class="game-overlay" id="gameOverlay">
                    <div class="overlay-content">
                        <h2 class="overlay-title">æ¸¸æˆç»“æŸ</h2>
                        <p class="overlay-score">æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
                        <button class="retry-btn" onclick="restartGame()">
                            <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                        </button>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-item">
                    <div class="info-label">
                        <i class="fas fa-trophy"></i> å½“å‰åˆ†æ•°
                    </div>
                    <div class="info-value" id="currentScore">0</div>
                </div>

                <div class="info-item">
                    <div class="info-label">
                        <i class="fas fa-level-up"></i> ä¸‹ä¸€çº§ç›®æ ‡
                    </div>
                    <div class="info-value" id="nextTarget">2</div>
                </div>

                <div class="info-item">
                    <div class="info-label">
                        <i class="fas fa-star"></i> æœ€é«˜è®°å½•
                    </div>
                    <div class="info-value" id="highScore">0</div>
                </div>

                <div class="achievement-grid">
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸ‰</div>
                        <div class="achievement-text">å°è¥¿ç“œ</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸˆ</div>
                        <div class="achievement-text">ä¸­è¥¿ç“œ</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸ¥‘</div>
                        <div class="achievement-text">å¤§è¥¿ç“œ</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-icon">âœ¨</div>
                        <div class="achievement-text">è¶…å¤§è¥¿ç“œ</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="watermelon-levels" id="levelDisplay">
            <div class="level-item" data-level="1">
                <div class="level-icon">ğŸ‰</div>
                <div>ä¸€çº§</div>
            </div>
            <div class="level-item" data-level="2">
                <div class="level-icon">ğŸ‰ğŸ‰</div>
                <div>äºŒçº§</div>
            </div>
            <div class="level-item" data-level="3">
                <div class="level-icon">ğŸˆ</div>
                <div>ä¸‰çº§</div>
            </div>
            <div class="level-item" data-level="4">
                <div class="level-icon">ğŸˆğŸ‰</div>
                <div>å››çº§</div>
            </div>
            <div class="level-item" data-level="5">
                <div class="level-icon">ğŸ¥‘</div>
                <div>äº”çº§</div>
            </div>
            <div class="level-item" data-level="6">
                <div class="level-icon">âœ¨</div>
                <div>å…­çº§</div>
            </div>
        </div>

        <div class="mobile-warning">
            <i class="fas fa-mobile-alt"></i> ç§»åŠ¨ç«¯ä½“éªŒå¯èƒ½ä¸ä½³ï¼Œå»ºè®®åœ¨æ¡Œé¢è®¾å¤‡ä¸Šæ¸¸æˆ
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const GAME_WIDTH = 600;
        const GAME_HEIGHT = 600;
        const CELL_SIZE = 100;
        const GRID_SIZE = GAME_WIDTH / CELL_SIZE;

        // è¥¿ç“œç­‰çº§é…ç½®
        const WATERMELON_LEVELS = [
            { emoji: 'ğŸ‰', name: 'å°è¥¿ç“œ', score: 1 },
            { emoji: 'ğŸ‰ğŸ‰', name: 'åŒè¥¿ç“œ', score: 2 },
            { emoji: 'ğŸˆ', name: 'ä¸­è¥¿ç“œ', score: 4 },
            { emoji: 'ğŸˆğŸ‰', name: 'å¤§è¥¿ç“œ', score: 8 },
            { emoji: 'ğŸ¥‘', name: 'è¶…å¤§è¥¿ç“œ', score: 16 },
            { emoji: 'âœ¨', name: 'ä¼ è¯´è¥¿ç“œ', score: 32 }
        ];

        // æ¸¸æˆçŠ¶æ€
        let gameRunning = false;
        let currentLevel = 0;
        let score = 0;
        let highScore = localStorage.getItem('highScore') || 0;
        let gameCanvas;
        let ctx;
        let watermelons = [];
        let fallQueue = [];
        let lastFallTime = 0;
        let fallInterval = 1000;
        let levelUpScore = 2;

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameCanvas = document.getElementById('gameCanvas');
            ctx = gameCanvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå°ºå¯¸
            resizeCanvas();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            currentLevel = 0;
            score = 0;
            watermelons = [];
            fallQueue = [];
            lastFallTime = 0;
            fallInterval = 1000;
            levelUpScore = 2;
            
            updateDisplay();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                resetGame();
                
                // ç«‹å³ç”Ÿæˆä¸€ä¸ªè¥¿ç“œ
                createWatermelon();
                
                // å¼€å§‹æ¸¸æˆå¾ªç¯
                requestAnimationFrame(gameLoop);
            }
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            startGame();
            hideGameOverlay();
        }

        // æ¸¸æˆå¾ªç¯
        function gameLoop(currentTime) {
            if (!gameRunning) return;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            update(currentTime);
            
            // æ¸²æŸ“æ¸¸æˆç”»é¢
            render();
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function update(currentTime) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°çš„è¥¿ç“œ
            if (currentTime - lastFallTime > fallInterval) {
                lastFallTime = currentTime;
                
                // éšæœºå†³å®šæ˜¯å¦ç”Ÿæˆ
                if (Math.random() < 0.7) {
                    createWatermelon();
                }
            }
            
            // æ›´æ–°æ‰€æœ‰è¥¿ç“œçš„ä½ç½®
            watermelons.forEach(watermelon => {
                watermelon.y += watermelon.speed;
                
                // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾åº•éƒ¨
                if (watermelon.y + watermelon.size > GAME_HEIGHT) {
                    watermelon.y = GAME_HEIGHT - watermelon.size;
                    watermelon.speed = 0;
                    
                    // æ£€æŸ¥æ˜¯å¦å¯ä»¥åˆæˆ
                    checkMerge(watermelon);
                }
            });
            
            // ç§»é™¤è¶…å‡ºåº•éƒ¨çš„è¥¿ç“œ
            watermelons = watermelons.filter(w => w.speed !== 0 || w.y + w.size <= GAME_HEIGHT);
        }

        // åˆ›å»ºæ–°çš„è¥¿ç“œ
        function createWatermelon() {
            const level = Math.min(currentLevel, WATERMELON_LEVELS.length - 1);
            const watermelon = WATERMELON_LEVELS[level];
            
            const newWatermelon = {
                x: Math.random() * (GAME_WIDTH - 50) + 25,
                y: -50,
                size: 50 + currentLevel * 20,
                speed: 2 + currentLevel * 0.5,
                level: currentLevel,
                emoji: watermelon.emoji,
                score: watermelon.score
            };
            
            fallQueue.push(newWatermelon);
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥åˆæˆ
        function checkMerge(watermelon) {
            const candidates = watermelons.filter(w => 
                w !== watermelon &&
                w.level === watermelon.level &&
                Math.abs(w.x - watermelon.x) < 40 &&
                Math.abs(w.y - watermelon.y) < 40
            );
            
            if (candidates.length > 0) {
                // æ‰§è¡Œåˆæˆ
                performMerge(watermelon, candidates[0]);
            }
        }

        // æ‰§è¡Œåˆæˆ
        function performMerge(w1, w2) {
            // ä»åˆ—è¡¨ä¸­ç§»é™¤
            watermelons = watermelons.filter(w => w !== w1 && w !== w2);
            
            // åˆ›å»ºæ–°çš„é«˜ç­‰çº§è¥¿ç“œ
            const newLevel = currentLevel + 1;
            if (newLevel < WATERMELON_LEVELS.length) {
                const newWatermelon = {
                    x: (w1.x + w2.x) / 2,
                    y: (w1.y + w2.y) / 2 - 25,
                    size: 50 + newLevel * 20,
                    speed: 0,
                    level: newLevel,
                    emoji: WATERMELON_LEVELS[newLevel].emoji,
                    score: WATERMELON_LEVELS[newLevel].score
                };
                
                watermelons.push(newWatermelon);
                
                // å¢åŠ åˆ†æ•°
                score += WATERMELON_LEVELS[newLevel].score;
                updateDisplay();
                
                // æ˜¾ç¤ºåˆæˆç‰¹æ•ˆ
                showMergeEffect(newWatermelon.x, newWatermelon.y);
                
                // æ£€æŸ¥æ˜¯å¦å‡çº§
                if (score >= levelUpScore) {
                    levelUp();
                }
            } else {
                // è¾¾åˆ°æœ€é«˜ç­‰çº§ï¼Œæ¸¸æˆèƒœåˆ©
                winGame();
            }
        }

        // çº§åˆ«å‡çº§
        function levelUp() {
            currentLevel++;
            fallInterval = Math.max(500, fallInterval - 200);
            levelUpScore *= 2;
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            
            // æ˜¾ç¤ºå‡çº§æç¤º
            showGameMessage('ç­‰çº§æå‡ï¼', 'æ­å–œ', 2000);
        }

        // æ¸¸æˆèƒœåˆ©
        function winGame() {
            gameRunning = false;
            showGameOverlay(`æ­å–œä½ åˆæˆ${WATERMELON_LEVELS[currentLevel].name}ï¼`, score);
        }

        // æ¸²æŸ“æ¸¸æˆç”»é¢
        function render() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            drawGrid();
            
            // ç»˜åˆ¶æ‰€æœ‰è¥¿ç“œ
            watermelons.forEach(watermelon => {
                drawWatermelon(watermelon);
            });
            
            // ç»˜åˆ¶ä¸‹è½é˜Ÿåˆ—ä¸­çš„è¥¿ç“œ
            fallQueue.forEach((watermelon, index) => {
                const progress = (Date.now() % 1000) / 1000;
                watermelon.y = -50 + index * 70 + progress * 70;
                drawWatermelon(watermelon);
            });
            
            // æ¸…ç©ºä¸‹è½é˜Ÿåˆ—
            fallQueue = [];
        }

        // ç»˜åˆ¶ç½‘æ ¼
        function drawGrid() {
            ctx.strokeStyle = 'rgba(90,159,90,0.3)';
            for (let i = 1; i < GRID_SIZE; i++) {
                ctx.beginPath();
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, GAME_HEIGHT);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(GAME_WIDTH, i * CELL_SIZE);
                ctx.stroke();
            }
        }

        // ç»˜åˆ¶è¥¿ç“œ
        function drawWatermelon(watermelon) {
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.shadowColor = 'rgba(90,159,90,0.8)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetY = 5;
            
            // ç»˜åˆ¶åœ†å½¢èƒŒæ™¯
            ctx.beginPath();
            ctx.arc(watermelon.x, watermelon.y, watermelon.size / 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶ emoji
            ctx.fillStyle = '#000000';
            ctx.font = `${watermelon.size - 10}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(watermelon.emoji, watermelon.x, watermelon.y);
            
            ctx.restore();
        }

        // æ˜¾ç¤ºåˆæˆç‰¹æ•ˆ
        function showMergeEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'game-effect';
            effect.innerHTML = 'âœ¨';
            effect.style.position = 'absolute';
            effect.style.left = x - 25 + 'px';
            effect.style.top = y - 25 + 'px';
            effect.style.fontSize = '50px';
            effect.style.animation = 'sparkle 1s ease-out forwards';
            effect.style.pointerEvents = 'none';
            
            gameCanvas.parentElement.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('currentScore').textContent = score;
            document.getElementById('nextTarget').textContent = levelUpScore;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('levelIndicator').textContent = `å½“å‰ç­‰çº§: ${currentLevel + 1}`;
            
            // æ›´æ–°ç­‰çº§æ˜¾ç¤º
            const levels = document.querySelectorAll('.level-item');
            levels.forEach(level => {
                level.classList.toggle('active', parseInt(level.dataset.level) === currentLevel + 1);
            });
        }

        // æ˜¾ç¤ºæ¸¸æˆè¦†ç›–å±‚
        function showGameOverlay(title, score) {
            const overlay = document.getElementById('gameOverlay');
            const finalScore = document.getElementById('finalScore');
            finalScore.textContent = score;
            overlay.style.opacity = '1';
        }

        // éšè—æ¸¸æˆè¦†ç›–å±‚
        function hideGameOverlay() {
            const overlay = document.getElementById('gameOverlay');
            overlay.style.opacity = '0';
            gameRunning = true;
        }

        // æ˜¾ç¤ºæ¸¸æˆæ¶ˆæ¯
        function showGameMessage(message, title, duration) {
            const gameContainer = document.querySelector('.game-container');
            const message = document.createElement('div');
            message.className = 'game-message';
            message.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 10px; color: var(--secondary);">${title}</div>
                <div style="font-size: 1rem; color: var(--primary);">${message}</div>
            `;
            gameContainer.appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transform = 'translateY(50px)';
                setTimeout(() => {
                    message.remove();
                }, 500);
            }, duration);
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
            gameCanvas.addEventListener('click', handleCanvasClick);
            
            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', handleKeyDown);
            
            // çª—å£å¤§å°æ”¹å˜äº‹ä»¶
            window.addEventListener('resize', resizeCanvas);
        }

        // å¤„ç†ç”»å¸ƒç‚¹å‡»
        function handleCanvasClick(e) {
            if (!gameRunning) return;
            
            const rect = gameCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†æŸä¸ªè¥¿ç“œ
            watermelons.forEach(watermelon => {
                const distance = Math.sqrt((x - watermelon.x) ** 2 + (y - watermelon.y) ** 2);
                if (distance < watermelon.size / 2) {
                    // ç‚¹å‡»äº†è¿™ä¸ªè¥¿ç“œï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œ
                    showGameMessage('ç‚¹å‡»äº†è¥¿ç“œ', 'æç¤º', 1000);
                }
            });
        }

        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameRunning) {
                    // æš‚åœæ¸¸æˆ
                    gameRunning = false;
                    showGameMessage('æ¸¸æˆæš‚åœ', 'æç¤º', 1000);
                ;;= 'Escape') {
                e.preventDefault();
                if (!gameRunning) {
                    // é‡æ–°å¼€å§‹æ¸¸æˆ
                    restartGame();
                }
            }
        }

        // é‡ç½®ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            const container = gameCanvas.parentElement;
            const width = Math.min(600, container.clientWidth - 100);
            const height = Math.min(600, container.clientHeight - 100);
            
            gameCanvas.width = width;
            gameCanvas.height = height;
            
            // é‡æ–°è®¡ç®—ç½‘æ ¼å¤§å°
            const newGridSize = width / CELL_SIZE;
            // è¿™é‡Œå¯èƒ½éœ€è¦é‡æ–°è®¡ç®—ä¸€äº›æ¸¸æˆé€»è¾‘
            
            render();
        }

        // æ·»åŠ ä¸€äº› CSS åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes sparkle {
                0% {
                    transform: scale(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.5) rotate(180deg);
                    opacity: 1;
                }
                100% {
                    transform: scale(0) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>



